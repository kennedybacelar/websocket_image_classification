<!DOCTYPE html>
<html>

<head>
    <title>My Page</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="frame">
        <img id="myImage" src="/images_ext_storage_mock/default/loading.jpg" alt="My Image">
    </div>
    <div class="frame">
        <p id="myQuote"></p>
    </div>

    <div class="upload-container">
            <form id="uploadForm" enctype="multipart/form-data">
                <input type="file" name="file" id="imageUpload">
                <button type="submit">Upload Image</button>
            </form>
            <p id="uploadStatus"></p>
    </div>
</body>
<script>
    const backend_port = 8050
    const frontend_port = 3020

    fetch('/config.json')
        .then(response => response.json())
        .then(config => {
            const backendHost = config.backendHost;
            const backendPort = config.backendPort;
            const frontendPort = config.frontendPort;
            
            const ws = new WebSocket(`ws://${backendHost}:${backendPort}/ws`);

            ws.addEventListener('open', () => {
                ws.send('Hello from frontend');
            });

            ws.addEventListener('message', (event) => {
                const folderName = event.data;
                if (folderName.trim().length > 0) {
                    fetch(`/get-random-filepath/${folderName}`)
                        .then(response => response.text())
                        .then(filepath => {
                            console.log(filepath);
                            const imageElement = document.getElementById('myImage');
                            imageElement.src = `http://${backendHost}:${frontend_port}${filepath}`;
                        });

                    fetch(`/get-random-quote/${folderName}`)
                        .then(response => response.text())
                        .then(randomQuote => {
                            console.log(randomQuote);
                            const quoteElement = document.getElementById('myQuote');
                            quoteElement.innerHTML = randomQuote;
                        })
                }

            });
        })
    
        document.getElementById('uploadForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const formData = new FormData();
            const imageFile = document.getElementById('imageUpload').files[0];

            if (imageFile) {
                formData.append('file', imageFile);  // Ensure the field name matches what the backend expects

                fetch('http://localhost:8050/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.text())
                .then(status => {
                    document.getElementById('uploadStatus').innerText = status;
                })
                .catch(error => {
                    document.getElementById('uploadStatus').innerText = 'Error uploading file.';
                    console.error(error);
                });
            } else {
                document.getElementById('uploadStatus').innerText = 'No file selected.';
            }
    });


</script>

</html>